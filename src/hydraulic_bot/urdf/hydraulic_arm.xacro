<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro">

    <xacro:macro name="hydraulic_arm" params="parent">
        
        <!-- Arm Base -->
        <link name="arm_base_link">
             <visual>
                <geometry>
                    <cylinder radius="0.15" length="0.1"/>
                </geometry>
                <origin xyz="0 0 0.05" rpy="0 0 0"/>
                <material name="black">
                    <color rgba="0.1 0.1 0.1 1.0"/>
                </material>
            </visual>
            <collision>
                <geometry>
                    <cylinder radius="0.15" length="0.1"/>
                </geometry>
                <origin xyz="0 0 0.05" rpy="0 0 0"/>
            </collision>
            <inertial>
                <mass value="5.0"/>
                <origin xyz="0 0 0.05" rpy="0 0 0"/>
                <inertia ixx="0.05" ixy="0.0" ixz="0.0" iyy="0.05" iyz="0.0" izz="0.1"/>
            </inertial>
        </link>

        <joint name="arm_base_joint" type="fixed">
            <parent link="${parent}"/>
            <child link="arm_base_link"/>
            <origin xyz="0.2 0 0.25" rpy="0 0 0"/> <!-- Mounted on top of the car chassis -->
        </joint>

        <!-- Shoulder (Joint 1) - Turret rotation (Z-axis) -->
        <link name="shoulder_link">
            <visual>
                <geometry>
                    <box size="0.2 0.2 0.3"/>
                </geometry>
                <origin xyz="0 0 0.15" rpy="0 0 0"/>
                <material name="orange">
                    <color rgba="1.0 0.5 0.0 1.0"/>
                </material>
            </visual>
            <collision>
                <geometry>
                    <box size="0.2 0.2 0.3"/>
                </geometry>
                <origin xyz="0 0 0.15" rpy="0 0 0"/>
            </collision>
             <inertial>
                <mass value="3.0"/>
                <origin xyz="0 0 0.15" rpy="0 0 0"/>
                <inertia ixx="0.1" ixy="0.0" ixz="0.0" iyy="0.1" iyz="0.0" izz="0.1"/>
            </inertial>
        </link>

        <joint name="shoulder_joint" type="revolute">
            <parent link="arm_base_link"/>
            <child link="shoulder_link"/>
            <origin xyz="0 0 0.1" rpy="0 0 0"/>
            <axis xyz="0 0 1"/>
            <limit lower="-3.14" upper="3.14" effort="100.0" velocity="1.0"/>
            <dynamics damping="1.0" friction="1.0"/>
        </joint>

        <!-- Upper Arm (Joint 2) - Lift (Y-axis) -->
        <link name="upper_arm_link">
             <visual>
                <geometry>
                    <box size="0.6 0.1 0.1"/>
                </geometry>
                <origin xyz="0.3 0 0" rpy="0 0 0"/>
                <material name="orange"/>
            </visual>
            <visual> <!-- Hydraulic Piston Visual -->
                <geometry>
                    <cylinder radius="0.04" length="0.3"/>
                </geometry>
                <origin xyz="0.15 0 0.1" rpy="0 1.0 0"/>
                <material name="silver">
                    <color rgba="0.8 0.8 0.8 1.0"/>
                </material>
            </visual>
            <collision>
                 <geometry>
                    <box size="0.6 0.1 0.1"/>
                </geometry>
                <origin xyz="0.3 0 0" rpy="0 0 0"/>
            </collision>
            <inertial>
                <mass value="2.0"/>
                <origin xyz="0.3 0 0" rpy="0 0 0"/>
                <inertia ixx="0.01" ixy="0.0" ixz="0.0" iyy="0.1" iyz="0.0" izz="0.1"/>
            </inertial>
        </link>

        <joint name="lift_joint" type="revolute">
            <parent link="shoulder_link"/>
            <child link="upper_arm_link"/>
            <origin xyz="0 0 0.25" rpy="0 0 0"/>
            <axis xyz="0 1 0"/>
            <limit lower="-1.0" upper="1.5" effort="200.0" velocity="0.5"/>
            <dynamics damping="1.0" friction="1.0"/>
        </joint>

        <!-- Forearm (Joint 3) - Reach (Y-axis) -->
        <link name="forearm_link">
             <visual>
                <geometry>
                    <box size="0.5 0.08 0.08"/>
                </geometry>
                <origin xyz="0.25 0 0" rpy="0 0 0"/>
                <material name="orange"/>
            </visual>
            <visual> <!-- Hydraulic Piston Visual -->
                 <geometry>
                    <cylinder radius="0.03" length="0.25"/>
                </geometry>
                <origin xyz="0.1 0 0.08" rpy="0 0.8 0"/>
                <material name="silver"/>
            </visual>
             <collision>
                <geometry>
                    <box size="0.5 0.08 0.08"/>
                </geometry>
                <origin xyz="0.25 0 0" rpy="0 0 0"/>
            </collision>
            <inertial>
                <mass value="1.5"/>
                <origin xyz="0.25 0 0" rpy="0 0 0"/>
                <inertia ixx="0.01" ixy="0.0" ixz="0.0" iyy="0.05" iyz="0.0" izz="0.05"/>
            </inertial>
        </link>

        <joint name="elbow_joint" type="revolute">
            <parent link="upper_arm_link"/>
            <child link="forearm_link"/>
            <origin xyz="0.6 0 0" rpy="0 0 0"/>
            <axis xyz="0 1 0"/>
            <limit lower="-2.0" upper="2.0" effort="150.0" velocity="0.8"/>
            <dynamics damping="0.5" friction="0.5"/>
        </joint>
        
        <!-- Wrist -->
        <link name="wrist_link">
            <visual>
                <geometry>
                    <cylinder radius="0.05" length="0.1"/>
                </geometry>
                <origin xyz="0 0 0" rpy="0 1.57 0"/>
                <material name="black"/>
            </visual>
            <collision>
                 <geometry>
                    <cylinder radius="0.05" length="0.1"/>
                </geometry>
                <origin xyz="0 0 0" rpy="0 1.57 0"/>
            </collision>
            <inertial>
                <mass value="0.5"/>
                <origin xyz="0 0 0" rpy="0 0 0"/>
                <inertia ixx="0.01" ixy="0.0" ixz="0.0" iyy="0.01" iyz="0.0" izz="0.01"/>
            </inertial>
        </link>

        <joint name="wrist_joint" type="revolute">
            <parent link="forearm_link"/>
            <child link="wrist_link"/>
            <origin xyz="0.5 0 0" rpy="0 0 0"/>
            <axis xyz="0 1 0"/>
            <limit lower="-1.5" upper="1.5" effort="50.0" velocity="1.0"/>
        </joint>

        <!-- Gripper -->
        <link name="gripper_base">
             <visual>
                <geometry>
                    <box size="0.05 0.15 0.05"/>
                </geometry>
                <origin xyz="0.025 0 0" rpy="0 0 0"/>
                <material name="grey">
                    <color rgba="0.5 0.5 0.5 1.0"/>
                </material>
            </visual>
            <collision>
                <geometry>
                    <box size="0.05 0.15 0.05"/>
                </geometry>
                <origin xyz="0.025 0 0" rpy="0 0 0"/>
            </collision>
             <inertial>
                <mass value="0.5"/>
                <origin xyz="0.025 0 0" rpy="0 0 0"/>
                <inertia ixx="0.01" ixy="0.0" ixz="0.0" iyy="0.01" iyz="0.0" izz="0.01"/>
            </inertial>
        </link>

        <joint name="gripper_joint" type="fixed">
            <parent link="wrist_link"/>
            <child link="gripper_base"/>
            <origin xyz="0.05 0 0" rpy="0 0 0"/>
        </joint>

        <!-- Fingers (Claw style) -->
        <link name="finger_left">
            <visual>
                <geometry>
                    <box size="0.1 0.02 0.05"/>
                </geometry>
                <origin xyz="0.05 0 0" rpy="0 0 0"/>
                <material name="black"/>
            </visual>
            <collision>
                <geometry>
                    <box size="0.1 0.02 0.05"/>
                </geometry>
                <origin xyz="0.05 0 0" rpy="0 0 0"/>
                <surface>
                    <friction>
                        <ode>
                             <mu>2.0</mu>
                             <mu2>2.0</mu2>
                        </ode>
                    </friction>
                </surface>
            </collision>
            <inertial>
                <mass value="0.1"/>
                <origin xyz="0.05 0 0" rpy="0 0 0"/>
                <inertia ixx="0.001" ixy="0.0" ixz="0.0" iyy="0.001" iyz="0.0" izz="0.001"/>
            </inertial>
        </link>

        <joint name="finger_left_joint" type="prismatic">
            <parent link="gripper_base"/>
            <child link="finger_left"/>
            <origin xyz="0.05 0.06 0" rpy="0 0 0"/>
            <axis xyz="0 1 0"/>
            <limit lower="-0.01" upper="0.05" effort="50.0" velocity="0.5"/>
        </joint>

        <link name="finger_right">
            <visual>
                <geometry>
                    <box size="0.1 0.02 0.05"/>
                </geometry>
                <origin xyz="0.05 0 0" rpy="0 0 0"/>
                <material name="black"/>
            </visual>
             <collision>
                <geometry>
                    <box size="0.1 0.02 0.05"/>
                </geometry>
                <origin xyz="0.05 0 0" rpy="0 0 0"/>
                 <surface>
                    <friction>
                        <ode>
                             <mu>2.0</mu>
                             <mu2>2.0</mu2>
                        </ode>
                    </friction>
                </surface>
            </collision>
            <inertial>
                <mass value="0.1"/>
                <origin xyz="0.05 0 0" rpy="0 0 0"/>
                <inertia ixx="0.001" ixy="0.0" ixz="0.0" iyy="0.001" iyz="0.0" izz="0.001"/>
            </inertial>
        </link>

        <joint name="finger_right_joint" type="prismatic">
            <parent link="gripper_base"/>
            <child link="finger_right"/>
            <origin xyz="0.05 -0.06 0" rpy="0 0 0"/>
            <axis xyz="0 -1 0"/>
            <mimic joint="finger_left_joint"/>
            <limit lower="-0.01" upper="0.05" effort="50.0" velocity="0.5"/>
        </joint>

        <!-- Gazebo Plugins for Joint Control -->
        <gazebo>
            <plugin filename="gz-sim-joint-position-controller-system" name="gz::sim::systems::JointPositionController">
                <joint_name>shoulder_joint</joint_name>
                <p_gain>1000</p_gain>
                <i_gain>10</i_gain>
                <d_gain>50</d_gain>
            </plugin>
             <plugin filename="gz-sim-joint-position-controller-system" name="gz::sim::systems::JointPositionController">
                <joint_name>lift_joint</joint_name>
                <p_gain>5000</p_gain>
                <i_gain>50</i_gain>
                <d_gain>100</d_gain>
            </plugin>
             <plugin filename="gz-sim-joint-position-controller-system" name="gz::sim::systems::JointPositionController">
                <joint_name>elbow_joint</joint_name>
                <p_gain>2000</p_gain>
                <i_gain>20</i_gain>
                <d_gain>50</d_gain>
            </plugin>
            <plugin filename="gz-sim-joint-position-controller-system" name="gz::sim::systems::JointPositionController">
                <joint_name>wrist_joint</joint_name>
                <p_gain>500</p_gain>
                <i_gain>5</i_gain>
                <d_gain>10</d_gain>
            </plugin>
            <plugin filename="gz-sim-joint-position-controller-system" name="gz::sim::systems::JointPositionController">
                <joint_name>finger_left_joint</joint_name>
                <p_gain>500</p_gain>
                <i_gain>10</i_gain>
                <d_gain>10</d_gain>
            </plugin>
             <plugin filename="gz-sim-joint-position-controller-system" name="gz::sim::systems::JointPositionController">
                <joint_name>finger_right_joint</joint_name>
                <p_gain>500</p_gain>
                <i_gain>10</i_gain>
                <d_gain>10</d_gain>
            </plugin>
        </gazebo>

    </xacro:macro>

</robot>
